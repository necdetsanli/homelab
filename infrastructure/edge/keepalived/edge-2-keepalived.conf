# Keepalived — edge-2 (BACKUP)
# Node: 192.168.20.21 | VIP: 192.168.20.22/24

global_defs {
  router_id EDGE-2
  enable_script_security
  script_user keepalived_script
}

vrrp_script chk_haproxy {
  script "/usr/local/lib/keepalived/check_haproxy.sh"
  interval 2
  timeout 2
  fall 3
  rise 3
  weight -30
  user keepalived_script
}

vrrp_instance VI_1 {
  state BACKUP
  interface eth0
  virtual_router_id 51
  priority 110
  advert_int 1

  preempt_delay 30

  # Unicast
  unicast_src_ip 192.168.20.21
  unicast_peer {
    192.168.20.20
  }

  authentication {
    auth_type PASS
    # REDACTED — replace with actual 8-char VRRP shared secret on the node
    auth_pass CHANGEME
  }

  virtual_ipaddress {
    192.168.20.22/24 dev eth0
  }

  track_script {
    chk_haproxy
  }

  garp_master_delay 1
  garp_master_repeat 5
  garp_master_refresh 60
  garp_master_refresh_repeat 2

  notify "/usr/local/sbin/keepalived-notify-certsync.sh"
}
