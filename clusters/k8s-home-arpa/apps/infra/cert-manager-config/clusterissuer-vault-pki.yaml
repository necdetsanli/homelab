# cert-manager ClusterIssuer — Vault PKI Integration
# Uses Kubernetes auth to request certificates from Vault's intermediate CA.
#
# Prerequisites (Vault side):
#   - PKI engine at pki_int/ with role "home-arpa-fqdns"
#   - Kubernetes auth enabled with role "cert-manager"
#   - Policy "cert-manager" allowing pki_int/sign/home-arpa-fqdns
#
# Traffic flow:
#   cert-manager pod → HAProxy VIP (192.168.20.22:443) → active Vault leader :8200
#   Pod SNAT to node IP (192.168.20.x) passes HAProxy's client_api_vlan ACL.
---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: vault-pki
spec:
  vault:
    server: "https://vault.home.arpa:443"
    path: "pki_int/sign/home-arpa-fqdns"
    caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUY0VENDQThtZ0F3SUJBZ0lVUVIyZlRIVi9WcmNaUnprdVl4eG9qN2dDQTU0d0RRWUpLb1pJaHZjTkFRRUwKQlFBd1BURUxNQWtHQTFVRUJoTUNWRkl4RWpBUUJnTlZCQW9UQ1dodmJXVXVZWEp3WVRFYU1CZ0dBMVVFQXhNUgphRzl0WlM1aGNuQmhJRkp2YjNRZ1EwRXdIaGNOTWpZd01qSXhNRGt5T0RFMldoY05Nell3TWpFNU1Ea3lPRFEyCldqQTlNUXN3Q1FZRFZRUUdFd0pVVWpFU01CQUdBMVVFQ2hNSmFHOXRaUzVoY25CaE1Sb3dHQVlEVlFRREV4Rm8KYjIxbExtRnljR0VnVW05dmRDQkRRVENDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQgpBT3ZxYlRhc2ZDWUFiQ1MrQzdWTjluUnF0cGVHc3dmZFFhUk5qMDJ2OHA5NXVSSUw1RzJEVUw4UndCU1NRNC9uCnJJR2dha2tObjZYc0VBVkhMNW4yQXZkeEJlU0IzM0ZFYnBlSnFqMjVYaUw0V0F3b3hYSkZUZTFtVlN1cWNpYnYKK1ZwNTcxTGREbmxRZkNNaDZaVEVyZ3RZUzNWSm5oZXJXSVdSUitsZDhWcnlGYzRVVlhERHdvdVQxbFB1K1RUVgo1bFpqTGRZV3A2VXdKUHBWN2JEeCtBVHdyTmZIdFBIU2JzTmI0N0R3NXhaUHJwd2dYYkZBS0tzUVBnQVo5OWJYCnlaUytDOEJIUTVDV1h4TXV3alpsQ3VzQWROeSs3U0gxemErSzBmeVlFS2hNa0dDRzBsZVJGR2k5UUxkV2JrVGMKUjNxTFQxZ0tPOGJMY1NVZi93LzYweU55aWh4MmxySnI0bThWUmFYZFdvM1dGbmRtYjY5dFNzVFpoZU1uL2dVQgpTZTc0R043aDF1UlhYRmNBdU1UYUF0a3kvM2x0M2hSM3FrbVlkekdOSlJSZXZhbnR5dXJ2R1pPSERXQ3NKNHliCkFGRG9vOSs0YWpoV2pBMmE5Sm5mMkZIeUtia09WL1ZhZDdJcHFJRnVYamVkaC9sNWxMaEtwOTZnZ0F6K0JzM1cKUHVhdE52YjVQZjhZL3MxcitLRnpWeWhJR0lQck53cmZnN2ZPQmV5b25pWGRiZjhDVjM5K0RFclNuK0gzQWZzTwpDMHQyWURvejRCRFJPbkpreHZNek1GRVcraDVBSXJkcjI0RndqZEtvUVhEMjZGUTRHeXZ6ZFoxczZDeGZhU2djCmNUZ1pzTThPYm1XeU5peDBwSStHT2ZMWVpDdTREeWVqa2k4QU9McUQxbzcvQWdNQkFBR2pnZGd3Z2RVd0RnWUQKVlIwUEFRSC9CQVFEQWdFR01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZNdXRKa2RJSUhxRgpCKzZmajVTazVLdUNiOEVhTUI4R0ExVWRJd1FZTUJhQUZNdXRKa2RJSUhxRkIrNmZqNVNrNUt1Q2I4RWFNRDBHCkNDc0dBUVVGQndFQkJERXdMekF0QmdnckJnRUZCUWN3QW9ZaGFIUjBjSE02THk5MllYVnNkQzVvYjIxbExtRnkKY0dFdmRqRXZjR3RwTDJOaE1ETUdBMVVkSHdRc01Db3dLS0Ftb0NTR0ltaDBkSEJ6T2k4dmRtRjFiSFF1YUc5dApaUzVoY25CaEwzWXhMM0JyYVM5amNtd3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnSUJBTDZza1grcTM1aFpyR0kyCk5sSmFEZEZic2lQVVlwZFdYMEFzeE9Uc2w2N3Rtc0g2SURsNGNVZG5sbW0rRHhDSzlVWlFDTGt6bUt6N3g4cEsKNGlQaFExZUZUb2NEdW1mSytGWUVTQ0dCY2FOS3Z1WFBwMXU5akVDRXZreVgrc0lGZTM0cFNGdGNKL25icGlrMgp2ekJwa0Rrb2huRFJsYjRrTnRUYUdRdnBKQlRiMmUzMXFQRnQrUUw5b25xTWRBNWhoSW1sQ1FqVGFxZkh5MS9DClBGVEt5NC92ZkZGTVRSVjFZVkZ2MnRpNEgvNkQ0RDFqZloyUnloSTZoa2ZMSkFZT1ZyTEhmYk9pdlpIMGJiZ3EKdDBFakdoK0hPNzVxSmlhanRoRUpDdDFLV3EzTE9xUzU2UVMxcFdsNDN2WWRIVmNWN290eThGMnJYbE1pcHdBVwppTHRiU0xNZ29wU2hrNjBObjFmR2pPUTh4cGZxMDNwRmE1MzRIckpuKzZsY2xrcjZQMG5uWDQwQzkyL3ZzSndJCldZTVdPeGVjK0tZUkFNYUc5djNUOU5vSzQyVUF6Rkl0blgyQ2ZOMFQ3TUt0N3ZWRmZRajJPbW9TOWxNMytBa3kKdjlNZ2dPMkpFKzh5WnJ5WGM0MjhVazFtZ3pCTDFuWDhHci9DbHpWK2JDMjVPaHhKMzgyVHJCWm15MFZ1WU53eAo3SEt5a2I3eG1qNk12MGM0bEh3U3ArVG80OTNQN1VlaDFtWUJEOEd5ODVxa09LTEw1L1l2VXFEYkV0QkRiYXFzCkhrVzBNcGxUU1VPbk1uZ0wzRTJUZ1kwZjd3RDV6aEZGcDFDb0N3ZTlDMFBKSnl4aWVnYWpVSVQzb3Y1MUxPS00KOWdHSThWSUYwM205UTNOTXVLdXVKUmVXUGVJMQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
    auth:
      kubernetes:
        role: cert-manager
        mountPath: /v1/auth/kubernetes
        serviceAccountRef:
          name: cert-manager
